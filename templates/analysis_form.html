{% extends "base.html" %}

{% block title %}Analysis Form - Statistical Model Suggester{% endblock %}

{% block container_start %}{% endblock %}

{% block extra_css %}
<style>
    /* Reset navbar margin */
    .navbar {
        margin-bottom: 0 !important;
        box-shadow: none;
    }

    /* Reset body background */
    body {
        background-color: transparent !important;
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .form-section {
        position: relative;
        width: 100%;
        padding: 0;
        background-color: #e8f4f8;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600' preserveAspectRatio='none'%3E%3Cdefs%3E%3ClinearGradient id='bg-gradient' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23e8f4f8' /%3E%3Cstop offset='100%25' stop-color='%23d0e8f0' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23bg-gradient)' /%3E%3C!-- Grid lines --%3E%3Cpath d='M0 50 L800 50 M0 100 L800 100 M0 150 L800 150 M0 200 L800 200 M0 250 L800 250 M0 300 L800 300 M0 350 L800 350 M0 400 L800 400 M0 450 L800 450 M0 500 L800 500 M0 550 L800 550 M50 0 L50 600 M100 0 L100 600 M150 0 L150 600 M200 0 L200 600 M250 0 L250 600 M300 0 L300 600 M350 0 L350 600 M400 0 L400 600 M450 0 L450 600 M500 0 L500 600 M550 0 L550 600 M600 0 L600 600 M650 0 L650 600 M700 0 L700 600 M750 0 L750 600' stroke='%23cae0ea' stroke-width='0.5' stroke-opacity='0.5' /%3E%3C!-- Bar chart --%3E%3Crect x='150' y='280' width='15' height='70' fill='%23267b9c' opacity='0.7' /%3E%3Crect x='170' y='250' width='15' height='100' fill='%23267b9c' opacity='0.7' /%3E%3Crect x='190' y='220' width='15' height='130' fill='%23267b9c' opacity='0.7' /%3E%3Crect x='210' y='260' width='15' height='90' fill='%23267b9c' opacity='0.7' /%3E%3Crect x='230' y='240' width='15' height='110' fill='%23267b9c' opacity='0.7' /%3E%3Crect x='250' y='270' width='15' height='80' fill='%23267b9c' opacity='0.7' /%3E%3C!-- Line chart --%3E%3Cpath d='M50 400 L100 380 L150 390 L200 350 L250 320 L300 330 L350 310 L400 300' fill='none' stroke='%23267b9c' stroke-width='2' /%3E%3Ccircle cx='50' cy='400' r='3' fill='%23267b9c' /%3E%3Ccircle cx='100' cy='380' r='3' fill='%23267b9c' /%3E%3Ccircle cx='150' cy='390' r='3' fill='%23267b9c' /%3E%3Ccircle cx='200' cy='350' r='3' fill='%23267b9c' /%3E%3Ccircle cx='250' cy='320' r='3' fill='%23267b9c' /%3E%3Ccircle cx='300' cy='330' r='3' fill='%23267b9c' /%3E%3Ccircle cx='350' cy='310' r='3' fill='%23267b9c' /%3E%3Ccircle cx='400' cy='300' r='3' fill='%23267b9c' /%3E%3C!-- Pie chart --%3E%3Cpath d='M600 180 L600 100 A80 80 0 0 1 674 142 Z' fill='%23267b9c' opacity='0.7' /%3E%3Cpath d='M600 180 L674 142 A80 80 0 0 1 652 242 Z' fill='%234a98b5' opacity='0.7' /%3E%3Cpath d='M600 180 L652 242 A80 80 0 0 1 548 242 Z' fill='%2370b3c9' opacity='0.7' /%3E%3Cpath d='M600 180 L548 242 A80 80 0 0 1 526 142 Z' fill='%2396cedd' opacity='0.7' /%3E%3Cpath d='M600 180 L526 142 A80 80 0 0 1 600 100 Z' fill='%23bee9f2' opacity='0.7' /%3E%3C!-- Hexagons with icons --%3E%3Cpath d='M100 120 L125 105 L150 120 L150 150 L125 165 L100 150 Z' fill='%23267b9c' fill-opacity='0.2' stroke='%23267b9c' stroke-width='1.5' /%3E%3Ctext x='125' y='142' text-anchor='middle' font-family='Arial' font-size='16' fill='%23267b9c'%3E%E2%86%91%3C/text%3E%3Cpath d='M620 420 L645 405 L670 420 L670 450 L645 465 L620 450 Z' fill='%23267b9c' fill-opacity='0.2' stroke='%23267b9c' stroke-width='1.5' /%3E%3Ctext x='645' y='442' text-anchor='middle' font-family='Arial' font-size='16' fill='%23267b9c'%3E%E2%9C%93%3C/text%3E%3Cpath d='M700 150 L725 135 L750 150 L750 180 L725 195 L700 180 Z' fill='%23267b9c' fill-opacity='0.2' stroke='%23267b9c' stroke-width='1.5' /%3E%3Ctext x='725' y='172' text-anchor='middle' font-family='Arial' font-size='16' fill='%23267b9c'%3E%E2%86%92%3C/text%3E%3C!-- Connecting lines --%3E%3Cpath d='M150 135 L200 135 M260 350 L300 350 M670 435 L700 435 M400 300 L450 300 L450 380' stroke='%23267b9c' stroke-width='1' stroke-dasharray='5,5' stroke-opacity='0.7' /%3E%3C!-- Data points scatter --%3E%3Ccircle cx='480' cy='150' r='3' fill='%23267b9c' /%3E%3Ccircle cx='500' cy='170' r='3' fill='%23267b9c' /%3E%3Ccircle cx='520' cy='140' r='3' fill='%23267b9c' /%3E%3Ccircle cx='490' cy='190' r='3' fill='%23267b9c' /%3E%3Ccircle cx='510' cy='160' r='3' fill='%23267b9c' /%3E%3Ccircle cx='470' cy='180' r='3' fill='%23267b9c' /%3E%3C!-- Statistical curve --%3E%3Cpath d='M450 440 C500 340, 550 340, 600 440' fill='none' stroke='%23267b9c' stroke-width='2' stroke-opacity='0.7' /%3E%3C/svg%3E");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        min-height: 100vh;
    }

    .form-content {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        padding: 40px;
        margin: 40px auto;
        position: relative;
        max-width: 1000px;
        z-index: 2; /* Ensure form appears above background elements */
    }

    .form-title {
        color: #4F46E5;
        font-size: 2.5rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 1rem;
    }

    .form-subtitle {
        color: #6B7280;
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: 2.5rem;
    }

    .form-group {
        background: #F9FAFB;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid #E5E7EB;
    }

    .form-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 10px;
        display: block;
    }

    .required-field::after {
        content: "*";
        color: #EF4444;
        margin-left: 4px;
    }

    .form-control, .form-select {
        width: 100%;
        padding: 12px;
        border: 1px solid #D1D5DB;
        border-radius: 6px;
        font-size: 1rem;
    }

    .form-control:focus, .form-select:focus {
        border-color: #6366F1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        outline: none;
    }

    .help-text {
        margin-top: 8px;
        color: #6B7280;
        font-size: 0.9rem;
    }

    .example-text {
        margin-top: 8px;
        color: #6B7280;
        font-size: 0.9rem;
        font-style: italic;
        padding-left: 12px;
        border-left: 2px solid #E5E7EB;
    }

    .form-check {
        padding: 6px 0;
    }

    .btn-primary {
        background-color: #4F46E5;
        border-color: #4F46E5;
        color: white;
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 500;
        border-radius: 6px;
    }

    .btn-primary:hover {
        background-color: #4338CA;
        border-color: #4338CA;
    }

    .optional-badge {
        font-size: 0.8rem;
        color: #6B7280;
        background: #F3F4F6;
        padding: 2px 8px;
        border-radius: 12px;
        margin-left: 6px;
        font-weight: 500;
        border: 1px solid #E5E7EB;
    }
    
    /* Remove previous background elements */
    .form-section::before, .form-section::after {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-section">
    <div class="container py-5">
        <div class="form-content">
            <h2 class="form-title">Statistical Model Finder</h2>
            <p class="form-subtitle">Answer a few simple questions about your research, and we'll help you find the most appropriate statistical model. Don't worry if you're not sure about some answers - we'll guide you through each step!</p>
            
            <!-- Example buttons -->
            <div class="text-center mb-4">
                <button type="button" id="mixed-effects-example" class="btn btn-outline-primary me-2">
                    <i class="bi bi-lightning-fill me-1"></i>Try Mixed Effects Model Example
                </button>
                <button type="button" id="elastic-net-example" class="btn btn-outline-success me-2">
                    <i class="bi bi-lightning-fill me-1"></i>Try Elastic Net Example
                </button>
                <button type="button" id="linear-regression-example" class="btn btn-outline-info me-2">
                    <i class="bi bi-lightning-fill me-1"></i>Try Linear Regression Example
                </button>
                <button type="button" id="cluster-analysis-example" class="btn btn-outline-warning me-2">
                    <i class="bi bi-lightning-fill me-1"></i>Try Cluster Analysis Example
                </button>
                <div class="help-text mt-2">
                    <i class="bi bi-info-circle me-1"></i>Click to auto-fill the form with inputs that would recommend different models
                </div>
            </div>
            
            <form method="POST" action="{{ url_for('main.results') }}">
                <div class="form-group">
                    <label for="research_question" class="form-label required-field">What are you trying to find out?</label>
                    <input type="text" class="form-control" id="research_question" name="research_question" required 
                           placeholder="Example: Does exercise affect weight loss?">
                    <div class="help-text">
                        <i class="bi bi-info-circle me-2"></i>Write your research question in simple terms, as if you're explaining it to a friend.
                    </div>
                    <div class="example-text">More examples: 
                        • Is there a relationship between study time and test scores?
                        • Do different teaching methods affect student performance?
                        • How does age influence blood pressure?
                    </div>
                </div>

                <div class="form-group">
                    <label for="analysis_goal" class="form-label required-field">What do you want to do with your data?</label>
                    <select class="form-select" id="analysis_goal" name="analysis_goal" required onchange="handleAnalysisGoalChange()">
                        <option value="">Choose what you want to do...</option>
                        <option value="predict">Make predictions about future outcomes</option>
                        <option value="classify">Sort items into categories</option>
                        <option value="explore">Understand relationships between variables</option>
                        <option value="cluster">Group similar data points together</option>
                        <option value="hypothesis_test">Test a specific theory or hypothesis</option>
                        <option value="non_parametric">Compare groups without assuming normal distribution</option>
                        <option value="predict">Predict numbers or counts</option>
                        <option value="time_series">Analyze patterns over time</option>
                    </select>
                    <div class="help-text">
                        <i class="bi bi-lightbulb me-2"></i>Think about what you want to achieve with your analysis.
                    </div>
                </div>

                <div class="form-group">
                    <label for="dependent_variable_type" class="form-label" id="dependent_variable_label">
                        What type of outcome are you measuring?
                        <span class="required-field" id="dependent_variable_required">*</span>
                        <span class="optional-badge d-none" id="dependent_variable_optional">Optional for clustering</span>
                    </label>
                    <select class="form-select" id="dependent_variable_type" name="dependent_variable_type" required>
                        <option value="">Select the type of your main measurement...</option>
                        <option value="continuous">Numbers that can take any value (e.g., height, weight, temperature)</option>
                        <option value="categorical">Categories with no order (e.g., color, gender, blood type)</option>
                        <option value="binary">Yes/No or Two Categories (e.g., pass/fail, success/failure)</option>
                        <option value="count">Whole numbers only (e.g., number of customers, incidents)</option>
                        <option value="time_series">Measurements taken over time (e.g., daily temperature, monthly sales)</option>
                    </select>
                    <div class="help-text" id="dependent_variable_help_default">
                        <i class="bi bi-graph-up me-2"></i>This is what you're trying to understand or predict in your study.
                    </div>
                    <div class="help-text d-none" id="dependent_variable_help_cluster">
                        <i class="bi bi-info-circle me-2"></i>For clustering, this field is optional since clustering algorithms don't always need a dependent variable.
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" id="independent_variables_label">
                        What types of information do you have to help explain your outcome?
                        <span class="required-field" id="independent_variables_required">*</span>
                        <span class="optional-badge d-none" id="independent_variables_optional">Optional for clustering</span>
                    </label>
                    <div class="help-text mb-3" id="independent_variables_help_default">
                        <i class="bi bi-list-check me-2"></i>Select all types of data you're using to explain or predict your outcome.
                    </div>
                    <div class="help-text mb-3 d-none" id="independent_variables_help_cluster">
                        <i class="bi bi-list-check me-2"></i>Select all types of data you want to use for clustering.
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="independent_variables" value="continuous" id="continuous_var">
                        <label class="form-check-label" for="continuous_var">
                            Numbers that can take any value (e.g., age, income, temperature)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="independent_variables" value="categorical" id="categorical_var">
                        <label class="form-check-label" for="categorical_var">
                            Categories or groups (e.g., education level, treatment groups)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="independent_variables" value="binary" id="binary_var">
                        <label class="form-check-label" for="binary_var">
                            Yes/No variables (e.g., smoker/non-smoker, employed/unemployed)
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        Are your independent variables correlated with each other?
                        <span class="optional-badge">Optional</span>
                    </label>
                    <div class="help-text mb-3">
                        <i class="bi bi-diagram-3 me-2"></i>Correlated variables move together (e.g., as height increases, weight tends to increase too).
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="variables_correlated" id="correlated_yes" value="yes">
                        <label class="form-check-label" for="correlated_yes">
                            Yes, my variables are likely correlated with each other
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="variables_correlated" id="correlated_no" value="no">
                        <label class="form-check-label" for="correlated_no">
                            No, my variables are likely independent from each other
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="variables_correlated" id="correlated_unknown" value="unknown" checked>
                        <label class="form-check-label" for="correlated_unknown">
                            I'm not sure
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sample_size" class="form-label">
                        How many observations or participants do you have?
                        <span class="optional-badge">Optional</span>
                    </label>
                    <input type="number" class="form-control" id="sample_size" name="sample_size" min="1" 
                           placeholder="Enter a number (e.g., 100)">
                    <div class="help-text">
                        <i class="bi bi-people me-2"></i>This is the total number of data points or participants in your study.
                    </div>
                </div>

                <div class="form-group">
                    <label for="missing_data" class="form-label required-field">Are there any missing values in your data?</label>
                    <select class="form-select" id="missing_data" name="missing_data" required>
                        <option value="">Choose the amount of missing data...</option>
                        <option value="none">No missing data - my dataset is complete</option>
                        <option value="little">A few missing values (less than 5%)</option>
                        <option value="moderate">Some missing values (5-15%)</option>
                        <option value="substantial">Many missing values (more than 15%)</option>
                    </select>
                    <div class="help-text">
                        <i class="bi bi-question-circle me-2"></i>Missing data are blank or empty values in your dataset.
                    </div>
                </div>

                <div class="form-group">
                    <label for="data_distribution" class="form-label">
                        How is your data distributed?
                        <span class="optional-badge">Optional</span>
                    </label>
                    <select class="form-select" id="data_distribution" name="data_distribution">
                        <option value="unknown">I'm not sure</option>
                        <option value="normal">Bell-shaped curve (most values in the middle)</option>
                        <option value="non_normal">Skewed or not bell-shaped</option>
                    </select>
                    <div class="help-text">
                        <i class="bi bi-bar-chart me-2"></i>Don't worry if you're not sure - we'll help you choose an appropriate model.
                    </div>
                </div>

                <div class="form-group">
                    <label for="relationship_type" class="form-label">
                        What kind of relationship do you expect?
                        <span class="optional-badge">Optional</span>
                    </label>
                    <select class="form-select" id="relationship_type" name="relationship_type">
                        <option value="unknown">I'm not sure</option>
                        <option value="linear">Straight line relationship (as one increases, the other increases/decreases steadily)</option>
                        <option value="non_linear">Curved or complex relationship</option>
                        <option value="hierarchical">Hierarchical or nested data (e.g., students within classrooms, measurements over time within individuals)</option>
                    </select>
                    <div class="help-text">
                        <i class="bi bi-graph-up-arrow me-2"></i>If you're not sure, that's okay! We'll consider all possibilities.
                    </div>
                </div>

                <div class="text-center mt-4 mb-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-magic me-2"></i>
                        <span>Find My Statistical Model</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const independentVariablesCheckboxes = document.querySelectorAll('input[name="independent_variables"]');
    
    // Initialize the form based on the current analysis goal selection
    handleAnalysisGoalChange();
    
    // Mixed Effects Model Example Button
    const mixedEffectsButton = document.getElementById('mixed-effects-example');
    if (mixedEffectsButton) {
        mixedEffectsButton.addEventListener('click', function() {
            // Fill research question
            document.getElementById('research_question').value = 
                "How do classroom characteristics and student factors affect test scores over multiple time points?";
            
            // Set analysis goal to predict
            document.getElementById('analysis_goal').value = "predict";
            
            // Set dependent variable to continuous
            document.getElementById('dependent_variable_type').value = "continuous";
            
            // Check both continuous and categorical independent variables
            document.querySelectorAll('input[name="independent_variables"]').forEach(checkbox => {
                if (checkbox.value === 'continuous' || checkbox.value === 'categorical') {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
            
            // Set sample size to 150 (large)
            document.getElementById('sample_size').value = "150";
            
            // Set missing data to moderate
            document.getElementById('missing_data').value = "moderate";
            
            // Set data distribution to normal
            document.getElementById('data_distribution').value = "normal";
            
            // Set relationship type to hierarchical (if available) or non_linear
            const relationshipField = document.getElementById('relationship_type');
            
            // Add hierarchical option if it doesn't exist
            if (!Array.from(relationshipField.options).some(option => option.value === 'hierarchical')) {
                const hierarchicalOption = document.createElement('option');
                hierarchicalOption.value = 'hierarchical';
                hierarchicalOption.text = 'Hierarchical or nested data (e.g., students within classrooms)';
                relationshipField.add(hierarchicalOption);
            }
            
            relationshipField.value = 'hierarchical';
            
            // Smooth scroll to the submit button
            document.querySelector('.btn-primary.btn-lg').scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    }
    
    // Elastic Net Example Button
    const elasticNetButton = document.getElementById('elastic-net-example');
    if (elasticNetButton) {
        elasticNetButton.addEventListener('click', function() {
            // Fill research question
            document.getElementById('research_question').value = 
                "How do multiple correlated predictors influence housing prices in different markets?";
            
            // Set analysis goal to predict
            document.getElementById('analysis_goal').value = "predict";
            
            // Set dependent variable to continuous
            document.getElementById('dependent_variable_type').value = "continuous";
            
            // Check continuous independent variables
            document.querySelectorAll('input[name="independent_variables"]').forEach(checkbox => {
                if (checkbox.value === 'continuous') {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
            
            // Set variables_correlated to yes
            document.getElementById('correlated_yes').checked = true;
            
            // Set sample size to 120 (large)
            document.getElementById('sample_size').value = "120";
            
            // Set missing data to little
            document.getElementById('missing_data').value = "little";
            
            // Set data distribution to normal
            document.getElementById('data_distribution').value = "normal";
            
            // Set relationship type to linear
            document.getElementById('relationship_type').value = 'linear';
            
            // Smooth scroll to the submit button
            document.querySelector('.btn-primary.btn-lg').scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    }
    
    // Linear Regression Example Button
    const linearRegressionButton = document.getElementById('linear-regression-example');
    if (linearRegressionButton) {
        linearRegressionButton.addEventListener('click', function() {
            // Fill research question
            document.getElementById('research_question').value = 
                "What factors affect student test scores and by how much?";
            
            // Set analysis goal to predict
            document.getElementById('analysis_goal').value = "predict";
            
            // Set dependent variable to continuous
            document.getElementById('dependent_variable_type').value = "continuous";
            
            // Check continuous and categorical independent variables
            document.querySelectorAll('input[name="independent_variables"]').forEach(checkbox => {
                if (checkbox.value === 'continuous' || checkbox.value === 'categorical') {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
            
            // Set variables_correlated to no
            document.getElementById('correlated_no').checked = true;
            
            // Set sample size to 80 (medium)
            document.getElementById('sample_size').value = "80";
            
            // Set missing data to none
            document.getElementById('missing_data').value = "none";
            
            // Set data distribution to normal
            document.getElementById('data_distribution').value = "normal";
            
            // Set relationship type to linear
            document.getElementById('relationship_type').value = 'linear';
            
            // Smooth scroll to the submit button
            document.querySelector('.btn-primary.btn-lg').scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    }
    
    // Cluster Analysis Example Button
    const clusterAnalysisButton = document.getElementById('cluster-analysis-example');
    if (clusterAnalysisButton) {
        clusterAnalysisButton.addEventListener('click', function() {
            // Fill research question
            document.getElementById('research_question').value = 
                "How can customers be grouped based on their purchasing behaviors and demographics?";
            
            // Set analysis goal to cluster (was explore before)
            document.getElementById('analysis_goal').value = "cluster";
            
            // Set dependent variable to a value that makes sense for clustering
            document.getElementById('dependent_variable_type').value = "continuous";
            
            // Check continuous and categorical independent variables
            document.querySelectorAll('input[name="independent_variables"]').forEach(checkbox => {
                if (checkbox.value === 'continuous' || checkbox.value === 'categorical') {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
            
            // Set variables_correlated to unknown
            document.getElementById('correlated_unknown').checked = true;
            
            // Set sample size to 200 (large)
            document.getElementById('sample_size').value = "200";
            
            // Set missing data to little
            document.getElementById('missing_data').value = "little";
            
            // Set data distribution to non_normal
            document.getElementById('data_distribution').value = "non_normal";
            
            // Set relationship type to non_linear (cluster structure)
            document.getElementById('relationship_type').value = 'non_linear';
            
            // Smooth scroll to the submit button
            document.querySelector('.btn-primary.btn-lg').scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    }
    
    form.addEventListener('submit', function(event) {
        const analysisGoal = document.getElementById('analysis_goal').value;
        const isClusteringGoal = analysisGoal === 'cluster' || analysisGoal === 'explore';
        
        // Check if at least one independent variable checkbox is selected
        // Skip this validation for clustering goals if no checkboxes are selected
        let atLeastOneChecked = false;
        independentVariablesCheckboxes.forEach(checkbox => {
            if (checkbox.checked) {
                atLeastOneChecked = true;
            }
        });
        
        if (!isClusteringGoal && !atLeastOneChecked) {
            event.preventDefault();
            alert('Please select at least one type of information (independent variable) to help explain your outcome.');
            
            // Highlight the independent variables section
            const independentVarsGroup = document.querySelector('input[name="independent_variables"]').closest('.form-group');
            independentVarsGroup.scrollIntoView({ behavior: 'smooth' });
            independentVarsGroup.style.borderColor = '#dc3545';
            
            // Remove the highlight after a delay
            setTimeout(() => {
                independentVarsGroup.style.borderColor = '';
            }, 3000);
        }
    });
});

function handleAnalysisGoalChange() {
    const analysisGoal = document.getElementById('analysis_goal').value;
    const isClusteringGoal = analysisGoal === 'cluster';
    
    // Get references to all the elements we need to modify
    const dependentVarField = document.getElementById('dependent_variable_type');
    const dependentVarRequired = document.getElementById('dependent_variable_required');
    const dependentVarOptional = document.getElementById('dependent_variable_optional');
    const dependentVarHelpDefault = document.getElementById('dependent_variable_help_default');
    const dependentVarHelpCluster = document.getElementById('dependent_variable_help_cluster');
    
    const independentVarsRequired = document.getElementById('independent_variables_required');
    const independentVarsOptional = document.getElementById('independent_variables_optional');
    const independentVarsHelpDefault = document.getElementById('independent_variables_help_default');
    const independentVarsHelpCluster = document.getElementById('independent_variables_help_cluster');
    
    if (isClusteringGoal) {
        // For clustering: make dependent variable optional
        dependentVarField.removeAttribute('required');
        dependentVarRequired.classList.add('d-none');
        dependentVarOptional.classList.remove('d-none');
        dependentVarHelpDefault.classList.add('d-none');
        dependentVarHelpCluster.classList.remove('d-none');
        
        // For clustering: adjust independent variables labels
        independentVarsRequired.classList.add('d-none');
        independentVarsOptional.classList.remove('d-none');
        independentVarsHelpDefault.classList.add('d-none');
        independentVarsHelpCluster.classList.remove('d-none');
    } else {
        // For non-clustering: make dependent variable required
        dependentVarField.setAttribute('required', 'required');
        dependentVarRequired.classList.remove('d-none');
        dependentVarOptional.classList.add('d-none');
        dependentVarHelpDefault.classList.remove('d-none');
        dependentVarHelpCluster.classList.add('d-none');
        
        // For non-clustering: adjust independent variables labels
        independentVarsRequired.classList.remove('d-none');
        independentVarsOptional.classList.add('d-none');
        independentVarsHelpDefault.classList.remove('d-none');
        independentVarsHelpCluster.classList.add('d-none');
    }
}
</script>
{% endblock %} 